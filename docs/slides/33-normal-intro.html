<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>STA 360/602L: Module 3.3</title>
    <meta charset="utf-8" />
    <meta name="author" content="Dr. Olanrewaju Michael Akande" />
    <link href="libs/font-awesome/css/all.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/v4-shims.css" rel="stylesheet" />
    <link rel="stylesheet" href="slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# STA 360/602L: Module 3.3
## The normal model: motivating examples
### Dr. Olanrewaju Michael Akande

---








## Motivating example: job training

- In the 1970s, researchers in the U.S. ran several randomized experiments intended to evaluate public policy programs. 

--

- One of the most famous experiments is the National Supported Work (NSW) Demonstration, in which researchers wanted to assess whether or not job training for disadvantaged workers had an effect on their wages. 

--

- Eligible workers were randomly assigned either to receive job training or not to receive job training. 

--

- Candidates eligible for the NSW were randomized into the program between March 1975 and July 1977.

--

- For more details, read Lalonde, R. J. (1986) and Dehejia, R., and Wahba, S. (1999).



---
## Motivating example: job training

- Setup:
  + **Pre-training wages**: real annual earnings in 1974 before training.
  
--
  + Two groups: some participants received job training and the rest did not.
  
--
  + **Post-training wages**: real annual earnings in 1978 upon completion of training.
  
--

- &lt;div class="question"&gt;
Question of interest: is there evidence that workers who receive job training tend to earn higher wages than workers who do not receive job training?
&lt;/div&gt;

--

- The original study really is a causal inference setup, but the data used in this example only uses a subset of the data.

--

- The data is richer than what we will use it for (i.e., there are covariates we can control for) but we will only focus on the pre and post wages for the two groups.




---
## Job training: the data

- Data:
  
  + No training group (N): sample size `\(n_N = 429\)`.
  
  + Training group (T): sample size `\(n_A = 185\)`.
  
  + **Diff wages**: Post-training wages -- Pre-training wages.

--

- Summary statistics for change in annual earnings:
  
  + `\(\bar{y}_N = 1364.93\)`; `\(s_N = 7460.05\)`
  
  + `\(\bar{y}_T = 4253.57\)`; `\(s_T = 8926.99\)`

--

- Wages/income are well known to be approximately normally distributed. Let's look at the distribution of "change in annual earnings" for the two groups.



---
## Job training: the data

&lt;img src="33-normal-intro_files/figure-html/unnamed-chunk-2-1.png" style="display: block; margin: auto;" /&gt;

Not completely normal but not too far off either. Lots of overlap between the two groups.


---
## Model for changes in earnings

- `$$y_i^{(T)} \sim \mathcal{N}(\mu_T,\sigma^2_T)$$`
  `$$y_i^{(N)} \sim \mathcal{N}(\mu_N,\sigma^2_N)$$`

--

- Want posterior distribution of `\(\mu_T - \mu_N\)`. Specifically, we would like to compute `\(\Pr[\mu_T &gt; \mu_N | Y_T, Y_N)\)` or equivalently, `\(\Pr[\mu_T - \mu_N &gt; 0 | Y_T, Y_N)\)`.

--

- Inference for `\(\mu_T - \mu_N\)` can be complicated in frequentist paradigm when `\(\sigma^2_T \neq \sigma^2_N\)`.

--

- Use approximate `\(t\)`-distributions based on the Welch-Satterthwaite degrees of freedom.

--

- Trivial with Bayesian inference

--

- By the way, also trivial to compute `\(\Pr[\sigma^2_T &gt; \sigma^2_N | Y_T, Y_N)\)` with Bayesian inference, which we will do later.

--

- How to do posterior inference for such normal models?



---
## Another example: Pygmalion study

- Pygmalion effect is a phenomenon where expectation affects performance.

--

- &lt;div class="question"&gt;
Question of interest: do teachers' expectations impact academic development of children?
&lt;/div&gt;

--

- Setup:
  + Researchers gave IQ test to elementary school children.
  
--
  + Randomly picked six children &amp; told teachers that the test predicts them to **have high potential for accelerated growth**.
  
--
  + They randomly picked six children and told teachers that the test predicts them to have **NO potential for growth**.
  
--
  + At end of school year, they gave IQ test again to all students.
  
--
  + They recorded the change in IQ scores of each student.



---
## Another example: Pygmalion study

- Data:
  
  + Accelerated group (A): 20, 10, 19, 15, 9, 18.
  
  + No growth group (N): 3, 2, 6, 10, 11, 5.
--

- Summary statistics:
  
  + `\(\bar{y}_A = 15.2\)`; `\(s_A = 4.71\)`.
  
  + `\(\bar{y}_N = 6.2\)`; `\(s_N = 3.65\)`.
  
--

- IQ test scores are also well known to be approximately normally distributed.

--

- Can't really check this assumption with only `\(n = 6\)` observations.



---
## Model for changes in scores

- `$$y_i^{(A)} \sim \mathcal{N}(\mu_A,\sigma^2_A)$$`
  `$$y_i^{(N)} \sim \mathcal{N}(\mu_N,\sigma^2_N)$$`

--

- Once again, we want posterior distribution of `\(\mu_A - \mu_N\)`. 

--

- As before, we would like to compute `\(\Pr[\mu_A &gt; \mu_N | Y_A, Y_N) \equiv \Pr[\mu_A - \mu_N &gt; 0 | Y_A, Y_N)\)`.

--

- We would also like to compute `\(\Pr[\sigma^2_A &gt; \sigma^2_N | Y_A, Y_N)\)`.

--

- To answer both questions, let's learn the Bayesian normal model.



---
## Normal distribution

- A random variable `\(Y\)` has a .hlight[normal distribution], written as `\(Y \sim \mathcal{N}(\mu, \sigma^2)\)`, if the pdf is
.block[
.small[
`$$p(y; \mu,\sigma^2) = \dfrac{1}{\sqrt{2\pi\sigma^2}} \ e^{-\dfrac{(y-\mu)^2}{2\sigma^2}}; \ \ \ y \in (-\infty,\infty), \ \ \mu \in (-\infty,\infty), \ \ \sigma \in (0,\infty).$$`
]
]

  where `\(\mu\)` is the mean and `\(\sigma^2\)` is the variance.

--

- It is also common (and would often be more convenient for our purposes) to write the pdf in terms of .hlight[precision], `\(\tau\)`, where `\(\tau = 1/\sigma^2\)`.

--

- In that case, the pdf is instead
.block[
.large[
`$$p(y; \mu,\sigma^2) = \dfrac{1}{\sqrt{2\pi}} \tau^{\frac{1}{2}} \ e^{-\frac{1}{2} \tau (y-\mu)^2}; \ \ \ y \in (-\infty,\infty), \ \ \mu \in (-\infty,\infty), \ \ \tau \in (0,\infty).$$`
]
]



---
## Example normal distributions

&lt;img src="33-normal-intro_files/figure-html/unnamed-chunk-3-1.png" style="display: block; margin: auto;" /&gt;



---
## Comments on the normal distribution

- It is amazing how often real data are close to normally distributed.

--

- Likely a consequence of CLT -- sums and means of independent random variables tend to be approximately normally distributed.

--

- Occurs under very general conditions.

--

- Normality?
  + Height, weight and other body measurements,
  + Income\wages\earnings,
  + Cumulative hydrologic measures such as annual rainfall or monthly river discharge,
  + Errors in astronomical or physical observations,
  + Many more examples!



---
## Properties of the normal distribution

- Mean, median and mode are all the same `\((\mu)\)`.

--

- Symmetric about the mean `\(\mu\)`.

--

- 95% of the density (95% probability) within `\(\pm1.96\sigma\)` (approximately two standard deviations) of the mean.

--

- If `\(X \sim \mathcal{N}(\theta,s^2)\)` and `\(Y \sim \mathcal{N}(\mu, \sigma^2)\)` with `\(X \perp Y\)`, then
.block[
.small[
`$$aX + bY \sim \mathcal{N}(a\theta + b\mu,a^2s^2+b^2\sigma^2),$$`
]
]

  for constants `\(a\)` and `\(b\)`.
  
--

- When independence does not hold, the sum of two normally distributed random variables is still normally distributed.

--

- However, when that is the case, we must account for the correlation in the variance term.



---
## Notes on normal distribution in R

- `rnorm`, `dnorm`, `pnorm`, `qnorm` in R take mean and **standard deviation** `\(\sigma\)` as arguments.

- If you use the variance `\(\sigma^2\)` instead you will get wrong answers!

- For example, `rnorm(n,m,s)` generates `\(n\)` normal random variables with mean `\(m\)` and standard deviation `\(s\)`, that is, `\(\mathcal{N}(m,s^2)\)`.



---
## Normal model

- Suppose we have independent observations `\(Y = (y_1,y_2,\ldots,y_n)\)`, where each `\(y_i \sim \mathcal{N}(\mu, \sigma^2)\)` or `\(y_i \sim \mathcal{N}(\mu, \tau^{-1})\)`, with unknown parameters `\(\mu\)` and `\(\sigma^2\)` (or `\(\tau\)`).

--

- Then, the likelihood is
.block[
.small[
$$
`\begin{split}
L(Y; \mu,\sigma^2) &amp; = \prod_{i=1}^n \dfrac{1}{\sqrt{2\pi}} \tau^{\frac{1}{2}} \ \textrm{exp}\left\{-\frac{1}{2} \tau (y_i-\mu)^2\right\}\\
&amp; \propto \tau^{\frac{n}{2}} \ \textrm{exp}\left\{-\frac{1}{2} \tau \sum_{i=1}^n (y_i-\mu)^2\right\}\\
&amp; \propto \tau^{\frac{n}{2}} \ \textrm{exp}\left\{-\frac{1}{2} \tau \sum_{i=1}^n \left[ (y_i-\bar{y}) - (\mu - \bar{y}) \right]^2 \right\}\\
&amp; \propto \tau^{\frac{n}{2}} \ \textrm{exp}\left\{-\frac{1}{2} \tau \left[ \sum_{i=1}^n (y_i-\bar{y})^2 - \sum_{i=1}^n(\mu - \bar{y})^2 \right] \right\}\\
&amp; \propto \tau^{\frac{n}{2}} \ \textrm{exp}\left\{-\frac{1}{2} \tau \left[ \sum_{i=1}^n (y_i-\bar{y})^2 - n(\mu - \bar{y})^2 \right] \right\}\\
&amp; \propto \tau^{\frac{n}{2}} \ \textrm{exp}\left\{-\frac{1}{2} \tau s^2(n-1) \right\} \ \textrm{exp}\left\{-\frac{1}{2} \tau n(\mu - \bar{y})^2 \right\}.\\
\end{split}`
$$
]
]



---
## Likelihood for normal model

- Likelihood:
.block[
.large[
`$$L(Y; \mu,\sigma^2) \propto \tau^{\frac{n}{2}} \ \textrm{exp}\left\{-\frac{1}{2} \tau s^2(n-1) \right\} \ \textrm{exp}\left\{-\frac{1}{2} \tau n(\mu - \bar{y})^2 \right\},$$`
]
]

  where
  + `\(\bar{y} =\sum_{i=1}^n y_i\)` is the sample mean; and
  + `\(s^2 = \sum_{i=1}^n (y_i-\bar{y})^2/(n-1)\)` is the sample variance.

- Sufficient statistics:
  + Sample mean `\(\bar{y}\)`; and
  + Sample sum of squares `\(SS = s^2(n-1) = \sum_{i=1}^n (y_i-\bar{y})^2\)`.

--

- MLEs:
  + `\(\hat{\mu} = \bar{y}\)`.
  + `\(\hat{\tau} = n/SS\)`, and `\(\hat{\sigma}^2 = SS/n\)`.



---
## Inference for mean, conditional on variance

- We can break down inference problem for this two-parameter model into two one-parameter problems.

--

- First start by developing inference on `\(\mu\)` when `\(\sigma^2\)` is known. Turns out we can use a conjugate prior for `\(\pi(\mu|\sigma^2)\)`. We will get to unknown `\(\sigma^2\)` in the next class.

--

- For `\(\sigma^2\)` known, the normal likelihood further simplifies to
.block[
.small[
`$$\propto \ \textrm{exp}\left\{-\frac{1}{2} \tau n(\mu - \bar{y})^2 \right\},$$`
]
]

  leaving out everything else that does not depend on `\(\mu\)`.
  
--

- For `\(\pi(\mu|\sigma^2)\)`, we consider `\(\mathcal{N}(\mu_0, \sigma_0^2)\)`, i.e., `\(\mathcal{N}(\mu_0, \tau_0^{-1})\)`, where `\(\tau_0^{-1} = \sigma_0^2\)`.

--

- Let's derive the posterior `\(\pi(\mu|Y,\sigma^2)\)`.



---
## Inference for mean, conditional on variance

- Posterior:
.block[
.small[
`$$\pi(\mu|Y,\sigma^2) \ \propto \ \pi(\mu|\sigma^2) L(Y; \mu,\sigma^2) \ \propto \ \textrm{exp}\left\{-\frac{1}{2} \tau_0 (\mu - \mu_0)^2 \right\}\  \textrm{exp}\left\{-\frac{1}{2} \tau n(\mu - \bar{y})^2 \right\}$$`
]
]

--

- Expanding out squared terms
.block[
.small[
`$$\Rightarrow \pi(\mu|Y,\sigma^2) \ \propto \ \textrm{exp}\left\{-\frac{1}{2} \tau_0 (\mu^2 - 2\mu\mu_0 + \mu_0^2) \right\}\  \textrm{exp}\left\{-\frac{1}{2} \tau n(\mu^2 - 2\mu\bar{y} + \bar{y}^2) \right\}$$`
]
]

--

- Ignoring terms not containing `\(\mu\)`
.block[
.small[
$$
`\begin{split}
\Rightarrow \pi(\mu|Y,\sigma^2) \ &amp; \propto \ \textrm{exp}\left\{-\frac{1}{2} \tau_0 (\mu^2 - 2\mu\mu_0) \right\}\  \textrm{exp}\left\{-\frac{1}{2} \tau n(\mu^2 - 2\mu\bar{y}) \right\}\\
&amp; \propto \ \textrm{exp}\left\{-\frac{1}{2} \left[\tau_0 (\mu^2 - 2\mu\mu_0)  + \tau n(\mu^2 - 2\mu\bar{y}) \right] \right\}\\
&amp; \propto \ \textrm{exp}\left\{-\frac{1}{2} \left[ \mu^2(\tau n + \tau_0) - 2\mu(\tau n\bar{y} + \tau_0\mu_0)   \right] \right\}.\\
\end{split}`
$$
]
]




---
## Inference for mean, conditional on variance

- Notice that `\(\left[ \mu^2(\tau n + \tau_0) - 2\mu(\tau n\bar{y} + \tau_0\mu_0)   \right]\)` is essentially a quadratic equation of the form `\(a^\star\mu^2 - 2b^\star\mu + c^\star\)`, where

--
  + `\(a^\star = \tau n + \tau_0\)`,
  
--
  + `\(b^\star = \tau n\bar{y} + \tau_0\mu_0\)`, and
  
--
  + `\(c^\star\)` does not depend on `\(\mu\)`.
  
      _Note that `\(c^\star\)` contains some of the terms we ignored on the previous slide but we need not know its exact form here._
  
--

- .hlight[Goal]: Turn this quadratic equation into an expression of the form `\(m(\mu - r)^2\)`, for some `\(m\)` and `\(r\)`, so that we have something that resembles the kernel of a normal density.

--

- &lt;div class="question"&gt;
How? Complete the square!
&lt;/div&gt;



---
## Inference for mean, conditional on variance

- Recall how to complete the square. Specifically, we can write
.block[
.small[
`$$a\mu^2 + b\mu + c$$`
]
]

  as
.block[
.small[
`$$a(\mu + d)^2 + e,$$`
]
]

  where
  + `\(d = \dfrac{b}{2a}\)`, and
  
  + `\(e = c - \dfrac{b^2}{4a}\)`.




---
## Inference for mean, conditional on variance

- Completing the square and rearranging (where `\(a^\star = \tau n + \tau_0\)` and `\(b^\star = \tau n\bar{y} + \tau_0\mu_0\)`),
.block[
.small[
$$
`\begin{split}
\Rightarrow \pi(\mu|Y,\sigma^2) \ &amp; \propto \ \textrm{exp}\left\{-\frac{1}{2} \left[ a^\star\mu^2- 2b^\star\mu\right] \right\}\\
&amp; = \ \textrm{exp}\left\{-\frac{1}{2} a^\star \left[ \mu^2- \dfrac{2b^\star}{a^\star}\mu\right] \right\}\\
&amp; = \ \textrm{exp}\left\{-\frac{1}{2} a^\star \left[ \mu^2- \dfrac{2b^\star}{a^\star}\mu + \dfrac{(b^\star)^2}{(a^\star)^2} \right] + \dfrac{(b^\star)^2}{2a^\star} \right\}\\
&amp; \propto \ \textrm{exp}\left\{-\frac{1}{2} a^\star \left[ \mu- \dfrac{b^\star}{a^\star} \right]^2 \right\},\\
\end{split}`
$$
]
]

  which is the kernel of a normal distribution with
    + mean `\(\dfrac{b^\star}{a^\star}\)`, and
    + precision `\(a^\star\)` or variance `\((a^\star)^{-1}\)`.



---
## Posterior with precision terms

- In terms of precision, we have
.block[
.large[
`$$\mu|Y,\sigma^2 \sim \mathcal{N}(\mu_n, \tau_n^{-1})$$`
]
]

  where
.block[
.small[
`$$\mu_n = \dfrac{b^\star}{a^\star} = \dfrac{\tau n\bar{y} + \tau_0\mu_0}{\tau n + \tau_0}$$`
]
]

  and
.block[
.small[
`$$\tau_n = a^\star = \tau n + \tau_0.$$`
]
]



---
## Posterior with precision terms

- As mentioned before, Bayesians often prefer to talk about precision instead of variance.

--

- We have
  + `\(\tau\)` as the sampling precision (how close the `\(y_i\)`'s are to `\(\mu\)`).
  
  + `\(\tau_0\)` as the prior precision (our prior belief about the uncertainty about `\(\mu\)` around our prior guess `\(\mu_0\)`).
  
  + `\(\tau_n\)` as the posterior precision

--

- As we have on the previous slide, _the posterior precision equals the prior precision plus the data precision_.

--

- That is, we see that the posterior information is a sum of the prior information and the information from the data.



---
## Posterior with precision terms: combining information

- Posterior mean is weighted sum of prior information plus data information:
.block[
.small[
$$
`\begin{split}
\mu_n &amp; = \dfrac{n\tau\bar{y} + \tau_0\mu_0}{\tau n + \tau_0}\\
&amp; = \dfrac{\tau_0}{\tau_0 + \tau n} \mu_0 + \dfrac{n\tau}{\tau_0 + \tau n} \bar{y}
\end{split}`
$$
]
]

--

- Recall that `\(\sigma^2\)` (and thus `\(\tau\)`) is known for now. 

--

- If we think of the prior mean as being based on `\(\kappa_0\)` prior observations from a similar population as `\(y_1,y_2,\ldots,y_n\)`, then we might set `\(\sigma_0^2 = \frac{\sigma^2}{\kappa_0}\)`, which implies `\(\tau_0 = \kappa_0 \tau\)`, and then the posterior mean is given by
.block[
.small[
$$
`\begin{split}
\mu_n &amp; = \dfrac{\kappa_0}{\kappa_0 + n} \mu_0 + \dfrac{n}{\kappa_0 + n} \bar{y}.
\end{split}`
$$
]
]


---
## Posterior with variance terms

- In terms of variances, we have
.block[
.large[
`$$\mu|Y,\sigma^2 \sim \mathcal{N}(\mu_n, \sigma_n^2)$$`
]
]

  where
.block[
.l.small[
`$$\mu_n = \dfrac{b^\star}{a^\star} = \dfrac{ \dfrac{n}{\sigma^2}\bar{y} + \dfrac{1}{\sigma^2_0} \mu_0}{\dfrac{n}{\sigma^2} + \dfrac{1}{\sigma^2_0}}$$`
]
]

  and
.block[
.small[
`$$\sigma^2_n = \dfrac{1}{a^\star} = \dfrac{1}{\dfrac{n}{\sigma^2} + \dfrac{1}{\sigma^2_0}}.$$`
]
]

--

- It is still easy to see that we can re-express the posterior information as a sum of the prior information and the information from the data.








---

class: center, middle

# What's next? 

### Move on to the readings for the next module!
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
